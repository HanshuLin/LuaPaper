\chapter{Translating function to FWLua\label{app:function}}

\section{Code in Lua}

\begin{verbatim}
function foo()
  local x = 0;
  return 
    function() 
       x = x + 1;
       return x; 
    end;
end;
bar = foo();
bar();
\end{verbatim}

\newpage
\section{Code in FWLua}

\begin{verbatim}
(function () return 

  (rawget(rawget(_ENV, "bar"), "_call"))()    --bar()
  
end)(
  
  (function () return
  
    rawset(_ENV, "bar", (rawget(rawget(_ENV, "foo"), "_call"))())   
    --bar = foo()
    
    end)(
   
      rawset(_ENV, "foo", rawset({}, "_call",
        function (_arg) return
          (function (_outer) return
            (function (_local) return
                (function () return             
                  rawset(rawset({}, "_arg", {}), "_call",
                    function (_arg) return
                       function (_outer) return
                        (function (_local) return
                          (function () return
                            rawget(_outer, "x")
                          end)(
                            rawset(_outer, "x", rawget(_outer, "x") + 1)
                          )  
                        end)({})
                      end)(_local)
                    end                  
                  end)(              
                    rawset(_local, "x", 10)                
                  )
            end)({})
          end)(_ENV)
        end)
      )
   )
)



\end{verbatim}
